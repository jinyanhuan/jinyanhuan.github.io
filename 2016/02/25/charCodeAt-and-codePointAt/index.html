<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>charCodeAt() and codePointAt() | code_bunny&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="这篇文章主要介绍javascript里的charCodeAt()方法和ES6引进的codePointAt()方法.
在说这两个方法之前,必须要先补充一些关于Unicode编码的知识…
ASCII码是256(2^8)个(0-255)数字,每一个数字都是一个码点(code point)[1].用于代表256个字符.但是这256个字符只是常用字符,各国语言,包括中文,远远超过这个范围.所以Unicode">
<meta property="og:type" content="article">
<meta property="og:title" content="charCodeAt() and codePointAt()">
<meta property="og:url" content="http://yoursite.com/2016/02/25/charCodeAt-and-codePointAt/index.html">
<meta property="og:site_name" content="code_bunny's blog">
<meta property="og:description" content="这篇文章主要介绍javascript里的charCodeAt()方法和ES6引进的codePointAt()方法.
在说这两个方法之前,必须要先补充一些关于Unicode编码的知识…
ASCII码是256(2^8)个(0-255)数字,每一个数字都是一个码点(code point)[1].用于代表256个字符.但是这256个字符只是常用字符,各国语言,包括中文,远远超过这个范围.所以Unicode">
<meta property="og:updated_time" content="2016-02-29T02:38:30.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="charCodeAt() and codePointAt()">
<meta name="twitter:description" content="这篇文章主要介绍javascript里的charCodeAt()方法和ES6引进的codePointAt()方法.
在说这两个方法之前,必须要先补充一些关于Unicode编码的知识…
ASCII码是256(2^8)个(0-255)数字,每一个数字都是一个码点(code point)[1].用于代表256个字符.但是这256个字符只是常用字符,各国语言,包括中文,远远超过这个范围.所以Unicode">
  
    <link rel="alternative" href="/atom.xml" title="code_bunny&#39;s blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <script src="http://libs.baidu.com/jquery/1.9.0/jquery.js"></script>
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			<img src="https://avatars1.githubusercontent.com/u/11350373?v=3&amp;s=460">
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">code_bunny</a></h1>
		</hgroup>

		
		<p class="header-subtitle">never giveup reading!</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/OOP-Code-Bunny/" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/p/1005052438739075/home" title="weibo">weibo</a>
					        
								<a class="rss" target="_blank" href="/#" title="rss">rss</a>
					        
								<a class="zhihu" target="_blank" href="/#" title="zhihu">zhihu</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/JSX/" style="font-size: 10px;">JSX</a> <a href="/tags/React/" style="font-size: 12.5px;">React</a> <a href="/tags/ajax/" style="font-size: 10px;">ajax</a> <a href="/tags/encoding/" style="font-size: 10px;">encoding</a> <a href="/tags/es5/" style="font-size: 15px;">es5</a> <a href="/tags/es6/" style="font-size: 17.5px;">es6</a> <a href="/tags/github/" style="font-size: 15px;">github</a> <a href="/tags/grunt/" style="font-size: 10px;">grunt</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/http/" style="font-size: 10px;">http</a> <a href="/tags/javascript/" style="font-size: 20px;">javascript</a> <a href="/tags/less/" style="font-size: 10px;">less</a> <a href="/tags/markdown/" style="font-size: 10px;">markdown</a> <a href="/tags/mongodb/" style="font-size: 10px;">mongodb</a> <a href="/tags/react/" style="font-size: 12.5px;">react</a> <a href="/tags/sass/" style="font-size: 10px;">sass</a> <a href="/tags/unicode/" style="font-size: 10px;">unicode</a> <a href="/tags/utf-16/" style="font-size: 10px;">utf-16</a> <a href="/tags/webstorm/" style="font-size: 12.5px;">webstorm</a> <a href="/tags/前端工程化/" style="font-size: 10px;">前端工程化</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://github.com/OOP-Code-Bunny/">我的github</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://github.com/a5635268/">周孝刚</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://kingarthas37.github.io/">王麟</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://github.com/zhengyin/">郑印</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">虽然咸鱼翻身还是咸鱼,但至少可以变得好吃一点</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">code_bunny</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img src="https://avatars1.githubusercontent.com/u/11350373?v=3&amp;s=460">
				<hgroup>
				  <h1 class="header-author">code_bunny</h1>
				</hgroup>
			</div>
			
			<p class="header-subtitle">never giveup reading!</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/OOP-Code-Bunny/" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/p/1005052438739075/home" title="weibo">weibo</a>
			        
						<a class="rss" target="_blank" href="/#" title="rss">rss</a>
			        
						<a class="zhihu" target="_blank" href="/#" title="zhihu">zhihu</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-charCodeAt-and-codePointAt" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/02/25/charCodeAt-and-codePointAt/" class="article-date">
  	<time datetime="2016-02-25T07:46:18.000Z" itemprop="datePublished">2016-02-25</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      charCodeAt() and codePointAt()
    </h1>
  

      </header>
      
      <div class="article-info">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/encoding/">encoding</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/es6/">es6</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/unicode/">unicode</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/utf-16/">utf-16</a></li></ul>
	</div>

        
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/blog/">blog</a>
	</div>


        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>这篇文章主要介绍javascript里的<code>charCodeAt()</code>方法和ES6引进的<code>codePointAt()</code>方法.</p>
<p>在说这两个方法之前,必须要先补充一些关于Unicode编码的知识…</p>
<p>ASCII码是256(2^8)个(0-255)数字,每一个数字都是一个码点(code point)[1].用于代表256个字符.但是这256个字符只是常用字符,各国语言,包括中文,远远超过这个范围.所以Unicode就出现了,Unicode源于一个很简单的想法：将全世界所有的字符包含在一个集合里，计算机只要支持这一个字符集，就能显示所有的字符，再也不会有乱码了。</p>
<p>可以这么理解,Unicode码是ASCII码的一个超集(superset).它的前128个code point和ASCII是一致的.后面又增加了很多很多字符.而UTF-32,UTF-8,UTF-16,都是Unicode码的编码形式:</p>
<a id="more"></a>
<p><strong>UTF-32</strong><br>用固定长度的四个字节来表示每个码点,就算有些字符只需要一个字节,也通过把空缺位添加0来强制转换成8个字节.由于四个字节有32-bit,所以称为UTF-32编码.由于太浪费空间,比ASCII编码文件要大四倍,所以不能使用.</p>
<p><strong>UTF-8</strong><br>用可变长度的字节来表示每个码点,如果只需要一个字节就能表示的,就用一个字节,一个不够,就用两个…所以,在UTF-8编码下,一个字符有可能由1-4个字节组成.</p>
<p><strong>UTF-16</strong><br>结合了固定长度和可变长度,它只有两个字节和四个字节两种方式来表示码点.如果是两个字节,那么码点的范围应该是（U+0000到U+FFFF）,如果是四个字节,那么码点的范围应该是（U+010000到U+10FFFF）.<br>但是注意,我们不能直接使用 <em>U+010000</em> 这样的形式(应该是因为位数不同所以不能…),所以,四个字节的码点需要使用两个 <em>code unit</em> [2],来组成一个 <em>surrogate pair</em> [3]. 其中第一个code unit的范围是从 <em>0xD800</em> 到 <em>0xDBFF</em>,被成为高位(high surrogate)或头位(lead surrogate),第二个code unit的范围是从 <em>0xDC00</em> 到 <em>0xDFFF</em>,被称为低位(low surrogate)或尾位(trail surrogate).</p>
<p>好了,有了以上的这些知识,就可以看看 <code>charCodeAt()</code> 和 <code>codePointAt()</code>了.</p>
<h2 id="charCodeAt()">charCodeAt()</h2><p><code>charCodeAt()</code>方法返回一个0-65535的整数,这个数代表了指定索引位置的UTF-16 code unit的码点.(UTF-16 code unit匹配的码点有两种可能,一种是这个码点本身可以代表一个字符,另一种是,这个code unit可能是一组 surrogate pair 里的一个code unit,它的码点本身不代表任何字符,比如 Unicode码点范围 &gt; 0x10000 的那些).如果你需要的是整个 surrogate pair 的码点值,请使用 <code>codePointAt*()</code> 方法.</p>
<h3 id="语法">语法</h3><pre><code>str.<span class="function"><span class="title">charCodeAt</span><span class="params">(index)</span></span>
</code></pre><h4 id="参数">参数</h4><p><strong>index</strong></p>
<p>一个大于等于0,小于字符串长度的整数; 如果它不是一个数字,默认为0.</p>
<h3 id="描述">描述</h3><p>Unicode 码点的范围是 0-1114111 (0x10FFFF). 最前面的128个Unicode码点和ASCII码指向的字符完全相同.</p>
<p>注意, <code>charCodeAt()</code> 总是返回一个小于65536的值,这是因为,大于65536的码点会使用两个小于65536的’surrogate’伪字符来组成一个真实字符.因此,为了检查或重现这类字符的整个码点(大于等于65536),不仅需要使用 <code>charCodeAt(i)</code> 来检索,还需要使用 <code>charCodeAt(i+1)</code>,这就好像通过两个字母来检查重现一个字符串那样. 或者也可以使用 <code>codePointAt(i)</code>. 查看下面的例子2和3.</p>
<p>如果索引值小于0或者大于等于字符串的长度,<code>charCodeAt()</code> 返回 <code>NaN</code>.</p>
<blockquote>
<p>注意,字符串的长度并不一定是你看到的字符的长度,有些中文字,比如<a href="http://www.zdic.net/z/87/wy/20BB7.htm" target="_blank" rel="external">‘ji’</a>,虽然只有一个字,但它的length是2.它就是Unicode码点大于等于65536的一个例子.</p>
</blockquote>
<p>向下兼容: 在历史版本(比如JavaScript 1.2), charCodeAt() 方法返回对应索引位置字符指向 <em>ISO-Lation-1</em> 字符集的一个数字. <em>ISO-Latin-1</em> 字符集的范围是 0 到255.其中0-127直接映射ASCII码.</p>
<h3 id="例子">例子</h3><h4 id="使用_charCodeAt()">使用 charCodeAt()</h4><p>下面这个例子返回65, ‘A’的Unicode码点.</p>
<pre><code><span class="variable">'ABC</span><span class="variable">'.charCodeAt</span><span class="list">(<span class="keyword">0</span>)</span><span class="comment">; // returns 65</span>
</code></pre><h4 id="改造charCodeAt()来处理当一开始并不知道非基本平面字符(non-Basic-Multilingual-Plane)_[4]的高位在哪个位置出现的情况:">改造charCodeAt()来处理当一开始并不知道非基本平面字符(non-Basic-Multilingual-Plane) [4]的高位在哪个位置出现的情况:</h4><p>这个版本可以用在循环或者类似的场景:一开始并不知道是否有非基本平面字符存在于指定的索引位置前.</p>
<pre><code><span class="function"><span class="keyword">function</span> <span class="title">fixedCharCodeAt</span>(<span class="params">str, idx</span>) </span>{
  <span class="comment">// ex. fixedCharCodeAt('\uD800\uDC00', 0); // 65536</span>
  <span class="comment">// ex. fixedCharCodeAt('\uD800\uDC00', 1); // false</span>
  idx = idx || <span class="number">0</span>;
  <span class="keyword">var</span> code = str.charCodeAt(idx);
  <span class="keyword">var</span> hi, low;

  <span class="comment">// 如果索引位置是一个高位 (可以把后面的十六进制改成0xDB7F来把高位当成一个单独的字符)</span>
  <span class="keyword">if</span> (<span class="number">0xD800</span> &lt;= code &amp;&amp; code &lt;= <span class="number">0xDBFF</span>) {
    hi = code;
    low = str.charCodeAt(idx + <span class="number">1</span>);
    <span class="keyword">if</span> (<span class="built_in">isNaN</span>(low)) {
      <span class="keyword">throw</span> <span class="string">'High surrogate not followed by low surrogate in fixedCharCodeAt()'</span>;
    }
    <span class="keyword">return</span> ((hi - <span class="number">0xD800</span>) * <span class="number">0x400</span>) + (low - <span class="number">0xDC00</span>) + <span class="number">0x10000</span>;
  }
  <span class="keyword">if</span> (<span class="number">0xDC00</span> &lt;= code &amp;&amp; code &lt;= <span class="number">0xDFFF</span>) { <span class="comment">// 低位</span>
    <span class="comment">// 返回false以跳出循环的本次迭代,因为在上次迭代时,遇到和它配对的那个高位时,已经处理过它了(处理的过程就是注释掉的那段)</span>
    <span class="keyword">return</span> <span class="literal">false</span>;
    <span class="comment">/*hi = str.charCodeAt(idx - 1);
    low = code;
    return ((hi - 0xD800) * 0x400) + (low - 0xDC00) + 0x10000;*/</span>
  }
  <span class="keyword">return</span> code;
}
</code></pre><h4 id="改造charCodeAt()来处理当一开始就已经知道非基本平面字符(non-Basic-Multilingual-Plane)_[4]的高位在哪个位置出现的情况:">改造charCodeAt()来处理当一开始就已经知道非基本平面字符(non-Basic-Multilingual-Plane) [4]的高位在哪个位置出现的情况:</h4><pre><code><span class="function"><span class="keyword">function</span> <span class="title">knownCharCodeAt</span>(<span class="params">str, idx</span>) </span>{
  str += <span class="string">''</span>;
  <span class="keyword">var</span> code,
      end = str.length;

  <span class="keyword">var</span> surrogatePairs = <span class="regexp">/[\uD800-\uDBFF][\uDC00-\uDFFF]/g</span>;
  <span class="keyword">while</span> ((surrogatePairs.exec(str)) != <span class="literal">null</span>) {
    <span class="keyword">var</span> li = surrogatePairs.lastIndex;
    <span class="keyword">if</span> (li - <span class="number">2</span> &lt; idx) {
      idx++;
    }
    <span class="keyword">else</span> {
      <span class="keyword">break</span>;
    }
  }

  <span class="keyword">if</span> (idx &gt;= end || idx &lt; <span class="number">0</span>) {
    <span class="keyword">return</span> <span class="literal">NaN</span>;
  }

  code = str.charCodeAt(idx);

  <span class="keyword">var</span> hi, low;
  <span class="keyword">if</span> (<span class="number">0xD800</span> &lt;= code &amp;&amp; code &lt;= <span class="number">0xDBFF</span>) {
    hi = code;
    low = str.charCodeAt(idx + <span class="number">1</span>);
    <span class="comment">// Go one further, since one of the "characters" is part of a surrogate pair</span>
    <span class="keyword">return</span> ((hi - <span class="number">0xD800</span>) * <span class="number">0x400</span>) + (low - <span class="number">0xDC00</span>) + <span class="number">0x10000</span>;
  }
  <span class="keyword">return</span> code;
}
</code></pre><h2 id="codePointAt()">codePointAt()</h2><p><code>codePointAt()</code>方法返回一个Unicode码点值,它是一个非负整数,</p>
<h3 id="语法-1">语法</h3><pre><code>str.<span class="function"><span class="title">codePointAt</span><span class="params">(pos)</span></span>
</code></pre><h4 id="参数-1">参数</h4><p><strong>pos</strong></p>
<p>指定从字符串里获取Unicode码点的索引位置.</p>
<h3 id="描述-1">描述</h3><p>如果在指定的位置没有元素,返回undefined.如果指定位置没有 UTF-16 surrogate pair, 返回指定位置的 code unit 的码点.</p>
<h3 id="栗子">栗子</h3><pre><code><span class="string">'ABC'</span>.codePointAt(<span class="number">1</span>);          <span class="comment">// 非UTF-16 surrogate pair ,返回A的Unicode码点: 66</span>
<span class="string">'\uD800\uDC00'</span>.codePointAt(<span class="number">0</span>); <span class="comment">// UTF-16 surrogate pair 返回整个字符的码点: 65536</span>

<span class="string">'XYZ'</span>.codePointAt(<span class="number">42</span>);         <span class="comment">// undefined</span>
</code></pre><h3 id="兼容低版本浏览器(Polyfill)">兼容低版本浏览器(Polyfill)</h3><p>下面的扩展允许你在原本不支持这个方法的低版本的浏览器中像支持ES6一样的使用codePointAt()方法.</p>
<pre><code><span class="comment">/*! http://mths.be/codepointat v0.1.0 by @mathias */</span>
<span class="keyword">if</span> (!<span class="built_in">String</span>.prototype.codePointAt) {
  (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
<span class="pi">    'use strict'</span>; <span class="comment">// needed to support `apply`/`call` with `undefined`/`null`</span>
    <span class="keyword">var</span> codePointAt = <span class="function"><span class="keyword">function</span>(<span class="params">position</span>) </span>{
      <span class="keyword">if</span> (<span class="keyword">this</span> == <span class="literal">null</span>) {
        <span class="keyword">throw</span> <span class="built_in">TypeError</span>();
      }
      <span class="keyword">var</span> string = <span class="built_in">String</span>(<span class="keyword">this</span>);
      <span class="keyword">var</span> size = string.length;
      <span class="comment">// `ToInteger`</span>
      <span class="keyword">var</span> index = position ? <span class="built_in">Number</span>(position) : <span class="number">0</span>;
      <span class="keyword">if</span> (index != index) { <span class="comment">// better `isNaN`</span>
        index = <span class="number">0</span>;
      }
      <span class="comment">// Account for out-of-bounds indices:</span>
      <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt;= size) {
        <span class="keyword">return</span> <span class="literal">undefined</span>;
      }
      <span class="comment">// Get the first code unit</span>
      <span class="keyword">var</span> first = string.charCodeAt(index);
      <span class="keyword">var</span> second;
      <span class="keyword">if</span> ( <span class="comment">// check if it’s the start of a surrogate pair</span>
        first &gt;= <span class="number">0xD800</span> &amp;&amp; first &lt;= <span class="number">0xDBFF</span> &amp;&amp; <span class="comment">// high surrogate</span>
        size &gt; index + <span class="number">1</span> <span class="comment">// there is a next code unit</span>
      ) {
        second = string.charCodeAt(index + <span class="number">1</span>);
        <span class="keyword">if</span> (second &gt;= <span class="number">0xDC00</span> &amp;&amp; second &lt;= <span class="number">0xDFFF</span>) { <span class="comment">// low surrogate</span>
          <span class="comment">// http://mathiasbynens.be/notes/javascript-encoding#surrogate-formulae</span>
          <span class="keyword">return</span> (first - <span class="number">0xD800</span>) * <span class="number">0x400</span> + second - <span class="number">0xDC00</span> + <span class="number">0x10000</span>;
        }
      }
      <span class="keyword">return</span> first;
    };
    <span class="keyword">if</span> (<span class="built_in">Object</span>.defineProperty) {
      <span class="built_in">Object</span>.defineProperty(<span class="built_in">String</span>.prototype, <span class="string">'codePointAt'</span>, {
        <span class="string">'value'</span>: codePointAt,
        <span class="string">'configurable'</span>: <span class="literal">true</span>,
        <span class="string">'writable'</span>: <span class="literal">true</span>
      });
    } <span class="keyword">else</span> {
      <span class="built_in">String</span>.prototype.codePointAt = codePointAt;
    }
  }());
}
</code></pre><h2 id="总结">总结</h2><p>上面关于<code>charCodeAt()</code>和<code>codePointAt()</code>的详解分别来自于:<br><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/charCodeAt" target="_blank" rel="external">charCodeAt()</a>以及<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/codePointAt" target="_blank" rel="external">codePointAt()</a>;</p>
<p>这里面有几个重点:</p>
<ol>
<li>Unicode 码点,基本多语言平面(Basic-Multilingual-Plane)只支持0-65535的码点,每个字符占用两个字节,对应一个码点,超过这个范围的码点,需要使用四个字节,两个 code unit,, 一个高位(U+D800到U+DBFF),一个低位(U+DC00到U+DFFF),他们组成一个 surrogate pair,代表一个字符.</li>
<li>charCodeAt() 方法只返回对应位置的code unit对应的码点.不管这个码点是不是代表了一个字符,不管这个code unit是独立的字符还是 surrogate pair 的一部分.</li>
<li>codePointAt() 方法返回对应位置的code unit 或 surrogate pair的码点: 遇到独立能代表字符的码点,就返回它; 遇到 surrogate pair 里的高位 code unit,就返回整个 surrogate pair 的码点; 遇到 surrogate pair 里的低位 code unit,也返回这个 code unit 对应的码点(虽然它不配合任何字符).</li>
<li>文章中多次用到一个公式,就是已知 surrogate pair 的高位 code unit 的码点和低位 code unit 的码点,如何求得整个 surrogate pair 的码点,这个公式来自于<a href="http://mathiasbynens.be/notes/javascript-encoding#surrogate-formulae" target="_blank" rel="external">surrogate-formulae</a></li>
</ol>
<p>最后,再给出一个综合例子,帮助理解:<a href="https://jsfiddle.net/caqmpasb/1/" target="_blank" rel="external">online site</a></p>
<pre><code>console.<span class="built_in">log</span>(<span class="string">'\uD800\uDC00'</span>.charCodeAt(<span class="number">0</span>)); <span class="comment"> //55296  </span>
console.<span class="built_in">log</span>(<span class="string">'\uD800\uDC00'</span>.charCodeAt(<span class="number">1</span>)); <span class="comment"> //56320  </span>
console.<span class="built_in">log</span>(<span class="string">'\uD800\uDC00'</span>.codePointAt(<span class="number">0</span>));<span class="comment"> //65536  获取的是整个 surrogate pair 的码点</span>
console.<span class="built_in">log</span>(<span class="string">'\uD800\uDC00'</span>.codePointAt(<span class="number">1</span>));<span class="comment"> //56320  获取的是'\uDC00'的码点, 同charCodeAt()   </span>
console.<span class="built_in">log</span>(<span class="string">'\uD800'</span>.codePointAt(<span class="number">0</span>));      <span class="comment"> //55296  获取的是'\uD800'的码点, 同charCodeAt()</span>

<span class="comment">
//根据阮一峰老师的文章:"当我们遇到两个字节，发现它的码点在U+D800到U+DBFF之间，就可以断定，紧跟在后面的两个字节的码点，应该在U+DC00到U+DFFF之间，这四个字节必须放在一起解读。"</span><span class="comment">
//所以,'\uD800\uDC00'应该两个码点一起解读,解读的结果就是65536</span>

console.<span class="built_in">log</span>(<span class="string">'𠮷'</span>.<span class="built_in">length</span>); <span class="comment"> //2</span>
console.<span class="built_in">log</span>(<span class="string">'𠮷'</span>.codePointAt(<span class="number">0</span>)); <span class="comment"> //134071 </span>
console.<span class="built_in">log</span>(<span class="string">'𠮷'</span>.codePointAt(<span class="number">1</span>)); <span class="comment"> //57271</span>
<span class="comment">
//𠮷(ji)这个字,是由两个码点,四个字节组成的,所以它的length是2.两个码点一起解读,得到的结果就是134071</span>
<span class="comment">
//最后一点,当获取这类需要两个码点一起解读组成一个字符的时候,如果获取高位的code point,它得到的会是整个字符的Unicode值,但如果获取低位的code point,它得到的依然是第二个码点的Unicode值.</span>
</code></pre><hr>
<p>[1]:<em>code point(码点)</em> Unicode里的码点,有几种表达方式,比如 ‘©’ 符号,它的码点是 <em>U+00A9</em> 或 <em>0xA9</em> 或 <em>\u00A9</em> 或十进制的 <em>169</em><br>其中 <em>\u00A9</em> 是js字符串里使用的方法, <em>0xA9</em> 是写js的时候使用的方法, <em>169</em> 最容易理解,就是一一对应的数字嘛,和ASCII的0-255数字一样,每个数字代表一个码点.</p>
<hr>
<p>[2]:<em>code unit</em> 不知道中文应该翻译成啥,编码单元? 在UTF-16编码方式时,如果是一个四字节的字符,比如上面一个土,下面一个口,念<a href="http://www.zdic.net/z/87/wy/20BB7.htm" target="_blank" rel="external">‘ji’</a>的那个字,它的Unicode码点是 <em>U+20BB7</em>,变成两个字节以后应该是 <em>\uD842\uDFB7</em> .在UTF-16编码里,需要由两个字节组成的字符,其中的每个字节就称为一个 <em>code unit</em> ,两个 <em>code unit</em> 组成一个 <em>surrogate pair</em>.  </p>
<hr>
<p>[3]:<em>surrogate pair</em> 不知道中文翻译成啥. 在UTF-16编码里,如有四个字节,两个 <em>code unit</em> 组成的字符,它就被称为 surrogate pair </p>
<hr>
<p>[4]:<em>Basic-Multilingual-Plane</em> 基本多语言平面. Unicode码点是由多个平面组成的,每个平面存放65536(2^16)个码点,其中第一个平面被称为 基本多语言平面 或者 BMP. 它包含了从 U+0000 到 U+FFFF 的码点,这些是各国最常用的字符.</p>
<hr>
<p>其他参考:<a href="http://www.ruanyifeng.com/blog/2014/12/unicode.html" target="_blank" rel="external">阮一峰老师写的Unicode资料</a></p>

        
      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/03/04/fromCodePoint/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          fromCodePoint()
        
      </div>
    </a>
  
  
    <a href="/2016/02/18/method-definations/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">method definitions</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>


<div class="share">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">分享到：</span>
		<a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
		<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>



<div class="duoshuo">
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="charCodeAt-and-codePointAt" data-title="charCodeAt() and codePointAt()" data-url="http://yoursite.com/2016/02/25/charCodeAt-and-codePointAt/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"true"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- 多说公共JS代码 end -->
</div>



</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2017 code_bunny
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/mobile.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>





<! -- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



  </div>
</body>
</html>